<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title><%= htmlWebpackPlugin.options.title %></title>
  </head>
  <body>
    <h3> URL </h3>
    <div id="publishUrlWrp">
      <input id="publishUrl" value="https://127.0.0.1:8443/live/whip?whipauth=username:password">
      <input type="button" id="publishBtn" value="Publish">
    </div>
    <h3> Local Video </h3>
    <div id="localVideoWrp">
      <video id="localVideo" autoplay muted></video> <br />
    </div>
    <h3> Logs </h3>
    <div id="logs"></div>
    <script type="text/javascript">
      var logItem = function(title,msg) {
        var logs = document.getElementById("logs");
        var p = document.createElement("p");
        var innerHTML = '<b>' + title + '</b>';
        if (msg) { innerHTML = innerHTML + '<br>' + msg.replace(/\n/g, '<br>')}
        p.innerHTML = innerHTML;

        logs.appendChild(p);
        logs.scrollTop = logs.scrollHeight;
      }

      document.addEventListener("DOMContentLoaded", function(event) {
        document.getElementById("publishBtn").addEventListener("click", function () {
          var config = {
            whipUrl:      document.getElementById("publishUrl").value,
            logLevel:     'info',
            videoElement: document.getElementById('localVideo'),

            onPublisherCreated: function(settings){ logItem('Ready to WebRTC publishing'); },
            onConnectionStateChange: function(connectionState){ logItem('Connection state change', connectionState); },
            onIceconnectionStateChange: function(connectionIceState){ logItem('Connection ice state change', connectionIceState); },
            onOffer: function(offer){ logItem('SDP offer', offer); },
            onAnswer: function(answer){ logItem('SDP answer', answer); },
            onConnectionError: function(){ logItem('Connection error'); }
          };
          var publisher = new WebRTCjs(config);
          publisher.publish();
        });
      });
    </script>
  </body>
</html>
